\documentclass[12pt]{article}
%\usepackage[a4paper, nohead, left=30mm, right=20mm, top=20mm, bottom=20mm]{geometry}
\usepackage[cp1251]{inputenc}
\usepackage[english,russian]{babel}
\usepackage[dvips]{color}
\usepackage[dvips]{graphicx}
\usepackage{amsmath,amsthm,amssymb}
\usepackage[ruled]{algorithm}
\usepackage{algorithmic}
\usepackage{array}
\usepackage{ulem}

\graphicspath{{../figures/eps/bw/}}

\floatname{algorithm}{Алгоритм}
\theoremstyle{plain}
\newtheorem{theorem}{Теорема}
\newtheorem{lemma}{Лемма}
\theoremstyle{definition}
\theoremstyle{definition}
\newtheorem{definition}{Определение}
\def\picref#1{рис.\,\ref{#1}}
\let\figureref=\picref
\def\RC{\hbox{root-code}}
\def\RCD{\hbox{root-code-decomp}}
\let\r=\textup
\let\ul=\underline
\let\emold=\em

\begin{document}
\title{Перечисление альтернированных $k$-танглов}
\author{В.\,Р.\,Мешков, А.\,С.\,Мишунин, А.\,В.\,Омельченко}
\maketitle

Теория узлов~--- исторически одна из первых областей топологии. Началом ее активного развития
послужили попытки Кельвина создать, ни много ни мало, теорию вещества. И хотя представление об
атомах как о заузленных вихрях эфира не нашло практического подтверждения, исключительная
наглядность объектов теории узлов по-прежнему побуждает математиков развивать эту теорию, а
физиков~--- искать ее приложения\footnote{Читателям, интересующимся такими приложениями, мы
рекомендуем книги серии ``Knots and everything'' издательства World Scientific Publishing
Company, в частности следующие две: Kauffman~L.~``Knots and physics'' и Baez~J.,
Muniain~J.~``Gauge fields, knots, and gravity''.}.

Маломерная топология и теория узлов в частности служит источником задач, интересных с
алгоритмической точки зрения. К классическим задачам такого рода относятся задачи перечисления и
классификации: требуется определить точное число представителей (узлов, зацеплений, кос, танглов)
в том или ином классе и предъявить список этих представителей без повторов и исключений. Данная
статья посвящена решению задачи перечисления т.\,н.~\textit{альтернированных танглов}. Прежде чем
будет описан алгоритм, скажем несколько слов о том, как танглы связаны с другими объектами,
изучаемыми в теории узлов.

\section{Виртуальные зацепления}

В конце 90-х годов прошлого столетия в теории узлов (см., например,
\cite{Prasolov1997,Duzhin1999}) появился новый объект~--- т.\,н.~виртуальные узлы и зацепления
\cite{Kauffman1999,Goussarov2000,Kuperberg2003}. Виртуальные зацепления отличаются от
<<классических>> тем, что диаграммы первых могут содержать мнимые, т.\,н.~виртуальные,
пересечения (\picref{virt01}).
\begin{figure}[ht]
\centering
\includegraphics{virtual-1.eps}
\caption{\footnotesize Плоские диаграммы обычного (a) и виртуального (b) зацеплений;
перекрестки пронумерованы, виртуальные перекрестки выделены кружками.\label{virt01}}
\end{figure}
\begin{definition}
\textit{Виртуальным зацеплением} называется класс эквивалентности конечного 4-валентного
графа\footnote{Мы намеренно используем определения в терминах теории графов, поскольку это
несколько упрощает изложение.}, в каждой вершине которого фиксирован циклический порядок ребер,
причем одна из пар противолежащих ребер помечена как <<верхняя>>. Отношение эквивалентности
задается движениями
Рейдемейстера:%\footnote{Строго говоря, к преобразованиям Рейдемейстера нужно добавить еще ряд преобразований с участием виртуальных перекрестков; подробности см.~в~\cite{Kauffman1999}.}:
$$
\def\pica#1{\raise-4mm\hbox{\protect\includegraphics[origin=c]{reidemeister-#1.eps}}}
\pica{11}\ \backsimeq\ \pica{12},\qquad
\pica{21}\ \backsimeq\ \pica{22},\qquad
\pica{31}\ \backsimeq\ \pica{32}.
$$
\end{definition}
Под это определение подпадают и обычные узлы и зацепления, но с оговоркой, что граф является
планарным, т.\,е.~его можно изобразить на плоскости так, что ребра не будут пересекаться
(\picref{virt01}a). Если же этого сделать нельзя, то <<вынужденные>> пересечения ребер как раз и
объявляются виртуальными (\picref{virt01}b).
\begin{definition}
Диаграмма узла (виртуального зацепления, тангла) называется \textit{альтернированной}, если
всякая дуга, соединяющая соседние (не виртуальные) перекрестки, в одном из них проходит сверху, а
в другом~--- снизу; узел (виртуальное зацепление, тангл) называется альтернированным, если среди
всевозможных его диаграмм найдется альтернированная.
\end{definition}
Например, зацепление на \picref{virt01}a является альтернированным, а виртуальное зацепление
на~\picref{virt01}b~--- нет.

Всякий граф можно расположить без пересечений (нарисовать) на сфере с некоторым числом ручек;
минимальное необходимое для этого число ручек называется \textit{родом графа}. Для графа с
заданным циклическим порядком ребер в вершинах (такие графы называются также ленточными или
\textit{вложенными графами}) род определяется однозначно, а само вложение единственно с точностью
до гомеоморфизмов поверхности \cite{Zvonkin2010}. Например, граф виртуального зацепления,
изображенного на \picref{virt01}b, имеет род~2~--- см.~\picref{virt03}. Вскоре после формального
введения виртуальных зацеплений в~\cite{Goussarov2000,Kauffman1999} стало ясно, что их
естественно задавать не плоскими диаграммами, а диаграммами, нарисованными на поверхностях
соответствующего рода, и рассматривать как зацепления <<над>> тором, кренделем (\picref{virt01})
и т.\,д.~\cite{Kuperberg2003}. Отметим, что виртуальные зацепления рода~1 (над тором) находят и
чисто практическое применение: такие зацепления естественным образом соответствуют
двоякопериодическим или <<текстильным>> переплетениям, и следовательно, соответствующая теория
может быть использована для создания топологической систематики тканых и вязанных
переплетений~\cite{We_JKTR2007,We_TRJ2009}.

\begin{figure}[ht]
\centering
\includegraphics{virtual-3.eps}
\caption{\footnotesize Виртуальное зацепление \picref{virt01}b, заданное диаграммой
на кренделе~--- поверхности рода~2.\label{virt03}}
\end{figure}


\section{Танглы и вложенные букеты}

Работа по перечислению виртуальных зацеплений в настоящий момент только начинается; некоторые
результаты получены лишь для альтернированных зацеплений, доля которых стремительно уменьшается с
увеличением рода зацепления (уже для рода~1 их примерно в 4 раза меньше в процентном отношении,
чем для обычных зацеплений) и стремится к нулю с увеличением числа перекрестков.

Один из возможных подходов к перечислению и классификации виртуальных зацеплений основан на
представлении их в виде комбинации вложенного букета окружностей и т.\,н.~тангла
(англ.~\textit{tangle}; буквально~--- спутанный клубок, сплетение). Наглядную иллюстрацию этого
представления дает \picref{virt02}.
\begin{figure}[h]
\centering
\includegraphics{virtual-2.eps}
\caption{\footnotesize Букет окружностей с пронумерованными ребрами (a), тангл (b) и их комбинация,
которая дает виртуальное зацепление \picref{virt01}b,\,\picref{virt03}.\label{virt02}}
\end{figure}
\begin{definition}
\textit{Вложенным букетом окружностей} называется одновершинный граф с фиксированным циклическим
порядком ребер.
\end{definition}
\begin{definition}\label{deftangle}
\textit{$k$-танглом} называется класс эквивалентности планарного графа с $2k$~вершинами
валентности~1 и некоторым числом вершин валентности~4, в каждой из которых фиксирован циклический
порядок ребер, причем одна из пар противолежащих ребер помечена как <<верхняя>>. Отношение
эквивалентности задается движениями Рейдемейстера.
\end{definition}
Поскольку порядок ребер в перекрестках определяет и порядок одновалентных вершин при вложении
графа в плоскость, эти вершины удобно считать расположенными в равноотстоящих точках единичной
окружности. Чтобы получить виртуальное зацепление, нужно взять букет $k$ окружностей, удалить
вершину и соединить концы ребер, не меняя их циклического порядка, с одновалентными вершинами
$k$-тангла. Если считать танглы, отличающиеся только поворотом или зеркальным отражением,
эквивалентными, то из данной пары $k$-тангла и $k$-букета таким способом можно получить $4k-2$,
вообще говоря, различных зацеплений.

Основное достоинство представления <<тангл-букет>> состоит в том, что вложенный букет отвечает за
все свойств виртуального зацепления, зависящие от рода, тогда как тангл представляет собой в
некотором смысле <<планарную часть>> диаграммы. Это позволяет, например, рассматривать зацепления
каждого рода отдельно, заранее перечислив соответствующие вложенные букеты.

Ясно, что комбинация вложенного букета рода~$g$ и любого тангла с соответствующим числом ног дает
некоторое виртуальное зацепление того же рода. Очевидно и обратное~--- всякое виртуальное
зацепление имеет такое представление. Действительно, взяв любое остовное дерево диаграммы, мы
можем стянуть его в точку по поверхности вместе со всеми перекрестками и получить вложенный букет
и тангл в окрестности точки стягивания. Каждая диаграмма допускает, разумеется, большое число
различных представлений <<тангл-букет>>, однако среди них можно по определенным правилам выделить
каноническое. Мы не будем на этом останавливаться.

Таким образом, перечисление виртуальных зацеплений можно начать с перечисления танглов и
вложенных букетов. В данной статье мы описываем алгоритм перечисления альтернированных
$k$-танглов; решению задачи перечисления вложенных букетов посвящена статья~\cite{We_Bouquet2010}
настоящего сборника.

\section{Перечисление $k$-танглов}

Следует отметить, что танглы (точнее, 2-танглы в смысле Определения~\ref{deftangle}) были введены
в теорию узлов Дж.\,Конвеем в качестве средства для описания и классификации узлов задолго до
появления виртуальных зацеплений~\cite{Conway1969}. Им же была предложено разделение 2-танглов на
классы рациональных, алгебраических и трансцендентных. Самым поддающимися исследованию оказались
рациональные танглы~--- для них проблема классификации полностью
решена~\cite{KauffmanLambropoulou2004}.
\begin{figure}[ht]
\centering
\includegraphics{rational-and-4-tangle.eps}
\caption{\footnotesize Рациональный тангл Конвея, 4-тангл общего вида.\label{virt04}}
\end{figure}
Помимо результатов~\cite{KauffmanLambropoulou2004}, на настоящий момент в данной области имеются
следующие достижения. Для простых альтернированных 2-танглов получено полиномиальное уравнение на
производящую функцию~\cite{SundbergThistlethwaite1998}. В~\cite{JustinZuber2003} и предшествующей
серии статей для перечисления альтернированных $k$-танглов используются матричные интегралы;
получены некоторые аналитические результаты, вычислены количества простых альтернированных 2-{} и
3-танглов с числом перекрестков до~11. Однако сложность предложенного метода быстро растет с
увеличением $k$. Таким образом, практически все имеющиеся результаты касаются альтернированных
2-танглов.

Целью данной работы является алгоритм, позволяющий получить все \textit{простые связные
альтернированные} $k$-танглы с количеством перекрестков, не превосходящим заданное число.
\begin{definition}
Тангл называется \textit{связным}, если любая его диаграмма связна как граф; тангл называется
\textit{простым}, если ни одна из его диаграмм не содержит нетривиального 1-подтангла
(т.\,е.~двуногого).
\end{definition}
Как и в случае обычных узлов и зацеплений, перечисление альтернированных танглов служит первым
этапом в задаче перечисления танглов общего вида. Дело в том, что, перечисляя альтернированные
танглы, мы, фактически, перечисляем \textit{проекции} или <<тени>> всех возможных танглов с
соответствующим числом перекрестков. Чтобы получить затем таблицу всех танглов, остается лишь
рассмотреть все возможные расстановки перекрестков в каждой из проекций.

Задача перечисления альтернированных $k$-танглов существенно проще общей задачи перечисления, что
обусловлено следующими важными свойствами альтернированных диаграмм.
\begin{enumerate}
\item Любая простая
%нередуцируемая (не допускающая упрощающего первого движения Рейдемейстера\footnote{Легко понять,
%что второе и третье преобразования Рейдемейстера в альтернированных диаграммах невозможны.})
альтернированная диаграмма является \textit{минимальной}, т.\,е.~у соответствующего тангла
нет диаграммы с меньшим числом перекрестков.
\item Все минимальные диаграммы простого альтернированного тангла могут быть получены друг из
друга применением (возможно, многократным) преобразования, называемого ``flype''
(см.~\figureref{figure:flype}).
\end{enumerate}
Первое из этих свойств гарантирует, что тангл, заданный альтернированной диаграммой с $n$
перекрестками, не может быть эквивалентен никакому танглу с меньшим числом перекрестков, а второе
свойство, известное как \textit{Tait flyping conjecture}, позволяет построить простой алгоритм
проверки эквивалентности двух танглов.
\begin{figure}[ht]
\centering
\includegraphics{c/flype.eps}
\caption{\footnotesize Flype-преобразование, переворачивающее 2-подтангл диаграммы\label{figure:flype}}
\end{figure}

Следует заметить, что при перечислении аналитическими методами, подобными использованным в
\cite{JustinZuber2003} и \cite{MenascoThistlethwaite1993}, не удается учесть наличие симметрий у
некоторых танглов, вследствие чего они оказываются посчитанными несколько раз. Вычислительный
подход позволяет устранить такие повторения. Подчеркнем, что с топологической точки зрения
естественно считать эквивалентными танглы, отличающиеся друг от друга лишь поворотом граничной
окружности или зеркальным отражением (иначе говоря, отличающиеся действием элемента группы диэдра
$D_{2k}$). Далее мы именно так и поступаем.

Предлагаемый ниже алгоритм перечисления альтернированных $k$-танглов является модифицированным
вариантом алгоритма перечисления \textit{проекций} $k$-танглов~\cite{We_arXiv2007}. Поэтому в
следующем параграфе мы коротко остановимся на основных идеях алгоритма~\cite{We_arXiv2007}.


\section{Перечисление проекций $k$-танглов}\label{section:projections}

Напомним, что проекции $k$-танглов отличаются от диаграмм тем, что в перекрестках нет разделения
дуг на верхнюю и нижнюю и, как следствие, преобразованию Рейдемейстера запрещены. Проекции
считаются одинаковыми, если одну из них можно перевести в другую композицией плоской изотопии и
элемента группы $D_{2k}$, то есть если они гомеоморфны.

\subsection{Элементарные операции с проекциями}\label{subsection:cutting}

\begin{definition}
Перекресток проекции назовем \textit{приграничным}, если он соединен одним из ребер проекции с
одной из ее \textit{граничных точек}~--- одновалентных вершин.
\end{definition}
\begin{definition}
\textit{Удалением приграничного перекрестка} проекции называется операция, при которой выбранный
перекресток удаляется из проекции вместе с ребрами, соединявшими его с граничными точками, а
свободные концы ребер, ранее соединявших перекресток с другими перекрестками, становятся новыми
граничными точками. Число граничных точек может при этом меняться на $0$, $2$, или $-2$. Обратная
операция называется \textit{приклеиванием приграничного перекрестка}.
\end{definition}
\begin{figure}[ht]
\centering
\def\pic#1{\raise-6mm\hbox{\includegraphics[scale=0.8]{border-deletion-sequence-#1.eps}}}
$\pic{6} {}\to{} \pic{5} {}\to{} \pic{4} {}\to{} \pic{3} {}\to{} \pic{2} {}\to{} \pic{1}$
\caption{\footnotesize Последовательные удаления приграничных перекрестков\label{figure:geneology}}
\end{figure}
В статье~\cite{We_arXiv2007} доказано, что любую простую связную проекцию можно, применяя
операцию удаления, превратить в простейшую~--- проекцию с одним перекрестком
(см.~\figureref{figure:geneology}), причем так, что все промежуточные проекции будут связными. И
обратно~--- любую простую связную проекцию можно получить из простейшей при помощи
последовательности операций приклеивания.

Исходя из сказанного, уже можно предложить следующий алгоритм перечисления. Пусть $P_n$~---
множество всех связных простых проекций с $n$ перекрестками; так, например, множество $P_1$
состоит из одного элемента~---  простейшей проекции:
$P_1=\bigl\{\raise-0.4em\hbox{\includegraphics{simplest-projection.eps}}\bigr\}$. Имея $P_n$, построим
множество $P_{n+1}$ следующим образом: возьмем мультимножество результатов всех возможных
приклеиваний приграничного перекрестка ко всем проекциям из $P_n$ и удалим из него дубликаты и
проекции, не являющиеся простыми.

Этот простой алгоритм, однако, не очень хорош, так как содержит трудоемкую стадию поиска
дубликатов. К счастью, оказывается, что от этого недостатка можно избавиться.


\subsection{Инвариант помеченных проекций}\label{subsection:root-code}

\begin{definition}
\textit{Помеченной проекцией} называется связная проекция $k$-тангла, снабженная тройкой
$r=(v,e,f)$, где $v$~--- перекресток проекции, $e$~--- ребро проекции, инцидентное $v$, и $f$~---
\textit{грань} проекции (область, ограниченная замкнутой цепью ребер), инцидентная $v$ и $e$.
Назовем $v$ \textit{помеченным перекрестком}, $e$~--- \textit{помеченным ребром} и $f$~---
\textit{помеченной гранью}. (См.~\picref{figure:rcode-example}.)
\end{definition}
Положение грани $f$ относительно перекрестка $v$ и ребра $e$ задает направление обхода~--- по
часовой стрелке или против часовой стрелки.
\begin{figure}[ht]
\centering
\includegraphics{c/rcode-example.eps}
\caption{\footnotesize Примеры вычисления инварианта \RC\label{figure:rcode-example}}
\end{figure}

Присвоим перекрестку $v$ номер 1, а остальные перекрестки пронумеруем согласно следующему
алгоритму (см.~\figureref{figure:rcode-example}).
\begin{algorithm}[H]\small
\caption{\small $\RC(P,(v,e,f)) $\label{algorithm:root-code}} \algsetup{linenosize=\small,
linenodelimiter=.}
\begin{algorithmic}[1]
    \STATE $A \leftarrow \{\}$
    \STATE $free \leftarrow 2$
    \STATE $Q \leftarrow \{v\}$
    \STATE $number[v] \leftarrow 1$
    \STATE $incoming[v] \leftarrow e$
    \WHILE{$Q \neq \varnothing$}
        \STATE $u \leftarrow head[Q]$
        \STATE $dequeue(Q)$
        \FOR{(для) всех ребер $(u, w) \in P$ в порядке,\\ заданном $f$, начиная с $incoming[u]$}
            \IF{$w$ --- конец диаграммы}
                \STATE $code \leftarrow 0$
            \ELSE
                \IF{$number[w]$ не определен}
                    \STATE $number[w] \leftarrow free$
                    \STATE $free \leftarrow free + 1$
                    \STATE $enqueue(Q, w)$
                \ENDIF
                \STATE $code \leftarrow number[w]$
            \ENDIF
            \STATE $push(A, code)$
        \ENDFOR
    \ENDWHILE
    \RETURN $A$
\end{algorithmic}
\end{algorithm}
Результатом работы алгоритма является последовательность $A$, в которой на каждый перекресток
проекции $P$ приходится 4~числа~--- номера соседних перекрестков в порядке обхода, заданном
тройкой $(v,e,f)$ (для приграничных перекрестков на позициях, соответствующих граничным точкам,
ставится $0$). Номера присваиваются перекресткам начиная с единицы в порядке обхода в ширину.
В~последовательности $A$ перекрестки описаны также в порядке возрастания номера.

Легко понять, что по заданной последовательности указанного вида исходная проекция однозначно
восстанавливается, следовательно одинаковым помеченным проекциям соответствуют одинаковые
последовательности, а разным~--- разные. Таким образом, последовательность $A$ представляет собой
\textit{инвариант} помеченных проекций; мы будем называть его \textit{root-code}.

Определим теперь $\RC(P,v)$, соответствующий перекрестку $v$ проекции $P$ как лексикографически
минимальный \RC{} среди всех восьми способов пометить проекцию $P$ с помеченной вершиной $v$.
Заметим, что $\RC(P,v)=\RC(P,u)$ для $v\neq u$, $v,u\in P$ тогда и только тогда, когда проекция
$P$ обладает нетривиальной группой симметрий, т.\,е.~существует автоморфизм (гомеоморфизм на
себя, симметрия) проекции $P$, переводящий $v$ в $u$.


\subsection{Алгоритм перечисления проекций}

\begin{figure}[ht]
\centering
\includegraphics[width=77mm]{c/genealogical-tree.eps}
\caption{\footnotesize <<Генеалогическое древо>> проекций\label{figure:genealogical-tree}}
\end{figure}

\begin{definition}
Пусть $I=\raise-0.4em\hbox{\includegraphics{simplest-projection.eps}}$ --- простейшая проекция. Определим на
множестве простых связных проекций $k$-танглов отображение $prev()$ со следующими свойствами:
\begin{itemize}
\item $prev(I)=\varnothing;$
\item $prev(T)$, $T\ne I$, является результатом удаления из проекции $T$ приграничного
перекрестка $v$, не являющегося \textit{точкой сочленения}, такого что $\RC(T,v)$
лексикографически минимален среди всех таких перекрестков.
\end{itemize}
\end{definition}
Согласно результатам параграфа~\ref{subsection:cutting}, отображение $prev()$ определено на всем
множестве простых связных проекций $k$-танглов. Оно однозначно благодаря тому, что все
удовлетворяющие определению способы выбора перекрестка отличаются друг от друга автоморфизмом
(см.~параграф~\ref{subsection:root-code}), следовательно все результаты удаления таких
приграничных перекрестков гомеоморфны друг другу, а гомеоморфные проекции мы друг от друга не
отличаем.

Благодаря указанным свойствам, $prev()$ задает на множестве всех связных простых проекций
структуру бесконечного дерева с корнем в $I$ (см.~\figureref{figure:genealogical-tree}). Для
перечисления всех проекций с не более чем $n$ перекрестками достаточно обойти это дерево
алгоритмом DFS (поиска в глубину) на глубину $n$
(см.~Алгоритм~\ref{algorithm:projections-enumeration}). Единственный тонкий момент, который нужно
учитывать, чтобы не спускаться по одному и тому же ребру несколько раз,~--- это возможное наличие
нетривиальных симметрий у проекций.
\begin{algorithm}[ht]\small
\caption{\small DFS(T)\label{algorithm:projections-enumeration}} \algsetup{linenosize=\small,
linenodelimiter=.}
\begin{algorithmic}[1]
    \PRINT $T$
    \IF{$crossings[T] = n$}
        \RETURN
    \ENDIF
    \STATE $list \leftarrow \varnothing$
    \FOR{(для) всех возможных результатов $R$\\приклеивания перекрестка $v$ к $T$}
        \IF{$R$ --- простая проекция}
            \IF{$prev(R) = T$}
                \STATE $r \leftarrow $ root-code($R$, $v$)
                \IF{ {\bf not} $contains(list, r)$}
                    \STATE DFS($R$)
                    \STATE $add(list, r)$
                \ENDIF
            \ENDIF
        \ENDIF
    \ENDFOR
\end{algorithmic}
\end{algorithm}


\section{Перечисление альтернированных $k$-танглов}\label{section:alternating}

Для начала заметим, что в любой связной проекции существует только два способа расставить
перекрестки альтернированным образом и эти способы мы различать не будем, поскольку они порождают
$k$-танглы, отличающиеся только зеркальным отражением. Таким образом, альтернированные танглы мы
будем рассматривать как подмножество множества проекций, содержащее по одному представителю из
каждого класса эквивалентности по flype-преобразованиям.

В этом параграфе нам понадобится несколько более сложный способ представления диаграмм, чем в
алгоритме генерации проекций, поэтому мы начнем с теоремы, следствиями которой будут важные
свойства нового представления.

\subsection{Теорема о пересекающихся танглах}

\begin{theorem}
\label{theorem:tangle-decomp-th} Пусть $A$ и $B$~--- связные подтанглы какой-либо простой
альтернированной диаграммы~$D$ тангла или зацепления, причем выполняются условия $A\setminus
B\neq\varnothing$, $B\setminus A\neq\varnothing$ и $A\cap B\neq\varnothing$. Тогда $A\setminus
B$, $B\setminus A$, $A\cap B$ и $A\cup B$ --- также связные танглы, а $A\cup B$ представ\'им в
виде \r(см.~\figureref{figure:tangle-decomp}\r)
\begin{figure}[H]
\centering
\includegraphics{tangle-decomp-theorem.eps}
\caption{\footnotesize К Теореме \ref{theorem:tangle-decomp-th}\label{figure:tangle-decomp}}
\end{figure}
\end{theorem}
\begin{proof}
Пусть $a$~--- число ребер, ведущих из $A\setminus B$ в остальную часть $D$; аналогично, $b$ и
$c$~--- число ребер, ведущих в остальную часть $D$ из $B\setminus A$ и из $A\cup B$
соответственно. Буквами $d$, $e$ и $f$ обозначим количество ребер между $A\setminus B$ и $A\cup
B$, между $B\setminus A$ и $A\cup B$ и между $A\setminus B$ и $B\setminus A$ соответственно
(см.~\figureref{figure:tangle-decomp-proof}). Так как $A$ и $B$ --- 2-танглы, то выполняются
соотношения
\begin{align}
a + c + e + f &= 4,\label{equation:a_relation}\\
b + c + d + f &= 4.\label{equation:b_relation}
\end{align}
Поскольку диаграмма $D$ простая, а у любого $k$-тангла четное число ног, мы получаем неравенства
\begin{align}
d + e + c &\ge 4,\label{equation:ab_relation}\\
a + b + c &\ge 4,\label{equation:all_relation}\\
a + d + f &\ge 4,\label{equation:amb_relation}\\
b + e + f &\ge 4.\label{equation:bma_relation}
\end{align}
\begin{figure}[H]
\centering
\includegraphics{tangle-decomp-proof.eps}
\caption{К доказательству Теоремы \ref{theorem:tangle-decomp-th}\label{figure:tangle-decomp-proof}}
\end{figure}
Складывая попарно \eqref{equation:a_relation} и \eqref{equation:b_relation},
\eqref{equation:ab_relation} и \eqref{equation:all_relation}, \eqref{equation:amb_relation} и
\eqref{equation:bma_relation}, получаем соответственно
\begin{align*}
&a + b + d + e + 2c + 2f = 8,\\
&a + b + d + e + 2c \ge 8,\\
&a + b + d + e + 2f \ge 8.
\end{align*}
Отсюда следует, что $c = f = 0$, а все нестрогие неравенства на самом деле являются равенствами.
В результате получаем систему линейных уравнений на $a$, $b$, $d$ и $e$, единственным решением
которой является $a = b = d = e = 2$. Завершим доказательство, заметив, что для связности
$A\setminus B$, $B\setminus A$ и $A\cap B$ достаточно чтобы диаграмма $D$ была простой.
\end{proof}


\subsection{Разложение на 2-танглы}\label{subsection:subtangle-decomposition}

Каждую генерируемую диаграмму будем представлять \textit{шаблоном}~--- специального вида
проекцией $k$-тангла с таким же количеством ног и с меньшим количеством перекрестков, в каждом из
которых хранится дополнительная информация о том, какой 2-тангл нужно подставить вместо этого
перекрестка, чтобы получить рассматриваемую диаграмму. (Похожая идея использовалась в
работе~\cite{SundbergThistlethwaite1998}.)

Так же, как и в алгоритме перечисления проекций, мы будем получать диаграммы, последовательно
приклеивая пограничные перекрестки. Однако теперь <<перекрестки>> будут разных типов, поскольку
каждый из них является, на самом деле, некоторым 2-танглом $T$ и может быть приклеен любым из
$\frac{|D_4|}{|G(T)|}$ способов. Здесь $G(T)\subset D_4$~--- группа симметрий 2-тангла~$T$.

Для любого $k$-тангла $T$ существует и притом единственное разложение его на максимальные
2-танглы, которое каждому перекрестку $v\in T$ сопоставляет такой 2-тангл $S(v)\subset T$, что
\begin{itemize}
\item $v \in S(v)$;
\item $\forall R \subset T$, где $R$ --- 2-тангл, $v \in R \Rightarrow R \subset S(v)$;
\item $\forall u, u \in S(v) \Leftrightarrow S(u) = S(v)$.
\end{itemize}
Заметим, что единственность разложения является следствием свойств, выполнения которых мы
потребовали, а существование~--- следствием Теоремы \ref{theorem:tangle-decomp-th}, при условии,
что тангл~$T$ имеет не менее шести ног. Если же $T$ является 2-танглом, то содержательного
разложения его на 2-танглы может и не существовать. Подобные случаи мы рассмотрим далее.
\begin{figure}[ht]
\centering
\includegraphics{tangle-decomp-example.eps}
\caption{\footnotesize Разложение на 2-танглы}
\end{figure}

Заметим, что flypе-преобразования не меняют структуру шаблона. Также заметим, что при удалении из
шаблона любого приграничного перекрестка, не являющегося точкой сочленения или единственным
перекрестком шаблона, получается так же корректный шаблон некоторого разложения.

Предположим, что у нас есть полный набор 2-танглов с числом перекрестков до $n$ с информацией об
их группах симметрии. Тогда, можно построить все множество $k$-танглов с числом перекрестков до
$n$, используя алгоритм, аналогичный описанному в параграфе~\ref{section:projections}. При этом
необходимо добавить проверку корректности шаблонов по ходу приклеивания; такая проверка сводится
к нахождению минимального разреза. Кроме того, нужно обобщить инвариант \RC{} на случай
разложений на 2-танглы. Этому вопросу посвящен следующий параграф.


\subsection{Инвариант разложений на 2-танглы}

Введем функцию $tangle$, сопоставляющую каждому перекрестку $v$ шаблона число $tangle(v)$~---
неотрицательный номер содержащегося там 2-тангла. При этом потребуем, чтобы у тангла из одного
перекрестка был минимально возможный номер. Также введем функцию $orientation(v,e,f)$~---
ориентацию 2-тангла, содержащегося в $v$ относительно входящего в $v$ ребра $e$ и направления
обхода, заданного гранью $f$.
\begin{algorithm}[ht]\small
\caption{\small root-code-decomp$(P, (v, e, f))$\label{algorithm:root-code-decomp}}
\algsetup{linenosize=\small, linenodelimiter=.}
\begin{algorithmic}[1]
\STATE $A \leftarrow \{\}$
\STATE $free \leftarrow 2$
\STATE $Q \leftarrow \{v\}$
\STATE $number[v] \leftarrow 1$
\STATE $incoming[v] \leftarrow e$
\WHILE{$Q \neq \varnothing$}
    \STATE $u \leftarrow head[Q]$
    \STATE $dequeue(Q)$

    \STATE $push(A, tangle(u))$

    \FOR{(для) всех ребер $(u, w) \in P$ в порядке,\\заданном $f$, начиная с $incoming[u]$}
        \IF{$w$ --- конец диаграммы}
            \STATE $code \leftarrow 0$
        \ELSE
            \IF{$number[w]$ не определен}
                \STATE $number[w] \leftarrow free$
                \STATE $free \leftarrow free + 1$
                \STATE $enqueue(Q, w)$
            \ENDIF
            \STATE $code \leftarrow number[w]$
        \ENDIF

        \STATE $push(A, code)$
    \ENDFOR

    \STATE $push(A, orientation(u, incoming[u], f))$
\ENDWHILE
\RETURN $A$
\end{algorithmic}
\end{algorithm}
По аналогии с \RC{} определим новый инвариант $\RCD(P,v)$, вычисляемый по
Алгоритму~\ref{algorithm:root-code-decomp}, для шаблонов с подставленными 2-танглами, добавив в
каждый перекресток информацию о содержащемся в нем 2-тангле и ориентации последнего относительно
входящего в перекресток ребра. Отметим теперь, что инвариант, вычисленный из вершины, содержащей
элементарный 2-тангл (из одного перекрестка), всегда будет лексикографически меньше, чем
вычисленный в вершине, содержащей нетривиальный 2-тангл.


\subsection{Перечисление 2-танглов}

Чтобы запустить алгоритм генерации $k$-танглов, $k\ge 3$, необходимо предварительно сгенерировать
2-танглы, играющие роль <<макроперекрестков>>. Для этого можно было бы использовать тот же
алгоритм, однако проблема состоит в том, что для 2-танглов разложение на максимальные 2-подтанглы
всегда тривиально, то есть состоит из одного макроперекрестка~--- тангла целиком. Чтобы
преодолеть это затруднение, введем в определение разложения для 2-танглов новое условие: если
2-тангл содержит более одного перекрестка, то его разложение не должно быть тривиальным.
Выясняется, однако, что в ряде случаев такое разложение может оказаться неединственным.
Разобраться с такими случаями помогает следующее утверждение.
\begin{theorem}\label{theorem:tangle-sum-th}
Если 2-тангл $T$ не допускает корректного разложения на 2-танглы, то $T$ представ\'им в виде
прямой суммы двух или более 2-танглов \r(\picref{figure:tangle-sum}\r).
\begin{figure}[H]
\centering
\includegraphics{tangle-sum.eps}
\caption{\footnotesize Прямая сумма $T_1, T_2,\cdots, T_s$\label{figure:tangle-sum}}
\end{figure}
\end{theorem}
\begin{proof}
Если для $T$ не существует разложения на 2-танглы, то в $T$ найдется перекресток $v$ и
2-подтанглы $A$ и $B$ такие, что $v \in A$, $v \in B$, $A\setminus B\neq\varnothing$, $B\setminus
A\neq\varnothing$ и внутри $T$ не существует подтангла, содержащего одновременно $A$ и $B$. Но по
Теореме~\ref{theorem:tangle-decomp-th} объединение $A \cup B$ представляет собой 2-тангл,
следовательно $T = A \cup B$.
\end{proof}
Теорема~\ref{theorem:tangle-sum-th} позволяет однозначно разбить все 2-танглы на две группы:
допускающие разложение в прямую сумму и не допускающие. Для второй группы всегда существует
корректное разложение на 2-танглы, поэтому ее можно обрабатывать так же как и танглы с числом ног
$k\ge3$. Разберемся с первой группой.

Чтобы обеспечить единственность разложения, мы будем собирать танглы первой группы из минимальных
слагаемых, т.\,е.~слагаемых, не допускающих дальнейшего разложения в прямую сумму в том же
направлении. По ходу сборки за этим условием следить легко: для каждого 2-тангла и двух
направлений в нем надо запоминать, раскладывается ли он в прямую сумму и в каком направлении.
\begin{figure}[ht]
\centering
\includegraphics{one-side-crossings.eps}
\caption{\footnotesize <<Свободные>> перекрестки с одной стороны\label{figure:one-side-crossings}}
\end{figure}

Как уже было сказано, в корректных шаблонах flype-преобразования невозможны, они реализуются лишь
в танглах, построенных как прямые суммы, и только при условии, что среди слагаемых встречаются
одиночные перекрестки. Очевидно, всегда можно добиться, чтобы все одиночные перекрестки
находились в прямой сумме по одну сторону от остальных слагаемых как
на~\figureref{figure:one-side-crossings}, таким образом, имеется всего два варианта их
расположения.

\begin{figure}
\centering
\includegraphics{d4-subgroups.eps}
\caption{\footnotesize Подгруппы группы диэдра $D_4$; $I$~--- тождественное преобразование,
$C$ --- поворот на $\pi/2$ против часовой стрелки, $E$~--- отражение\label{figure:D4-subgroups}}
\end{figure}
Для вычисления функции $orientation(v,e,f)$ необходимо знать группы симметрии всех 2-танглов;
каждая из этих групп является одной из 10 подгрупп группы $D_4$. Вычислением \RCD{} для
соответствующих пометок в 2-тангле можно проверить любой из элементов $D_4$ на принадлежность
группе симметрий. Проверив таким образом несколько элементов согласно
\figureref{figure:D4-subgroups}, можно установить группу симметрии собранного по шаблону тангла.
При вычислении группы симметрии прямой суммы, необходимо рассматривать оба возможных положения
одиночных перекрестков.

Общая схема алгоритма получения 2-танглов с не более чем $n$ перекрестками выглядит следующим
образом. Запускаем общий алгоритм генерации альтернированных $k$-танглов, однако рассматриваем
теперь в процессе также 2-танглы, собранные по шаблону, и прямые суммы. По ходу выполнения
алгоритма сохраняем в память те $k$-танглы, из которых могут в последствии получится 2-танглы (в
Таблице~\ref{table:alternating-tangles-table} соответствующие числа подчеркнуты); число таких
танглов гораздо меньше общего числа $k$-танглов с не более чем $n$ перекрестками всего. Когда в
процессе исполнения алгоритма получается новый 2-тангл, пробуем приклеить его во всех возможных
позициях к уже известным $k$-танглам.

Правила генерации прямых сумм приведены в Таблице~\ref{table:sums-rules}. Случаи 6 и 8
исключаются вследствие того, что код тангла из одного перекрестка всегда меньше кода любого
другого 2-тангла. В случае 3 необходимо решить, на какой из двух сторон от остальных слагаемых
будут расположены одиночные перекрестки. Сделать это можно, выбрав конфигурацию, дающую
минимальный инвариант \RCD.
\begin{table}[H]\small
\caption{\small Правила сборки прямых сумм\label{table:sums-rules}} \centering
\begin{tabular}{cm{22mm}l}
\hline
1 & \includegraphics[width=20mm]{alternating-build-4-case-1.eps} & --- принять; \\
2 & \includegraphics[width=20mm]{alternating-build-4-case-2.eps} & --- принять; \\
3 & \includegraphics[width=20mm]{alternating-build-4-case-3.eps} & --- сравнить два варианта расположения; \\
4 & \includegraphics[width=20mm]{alternating-build-4-case-4.eps} & --- нарушается положение перекрестков; \\
5 & \includegraphics[width=20mm]{alternating-build-4-case-5.eps} & --- нарушается положение перекрестков; \\
6 & \includegraphics[width=20mm]{alternating-build-4-case-6.eps} & --- не бывает; \\
7 & \includegraphics[width=20mm]{alternating-build-4-case-7.eps} & --- принять; \\
8 & \includegraphics[width=20mm]{alternating-build-4-case-8.eps} & --- не бывает. \\
\hline
\end{tabular}
\end{table}

\subsection{Результаты}

При помощи описанного алгоритма мы сгенерировали $k$-танглы с числом перекрестков до 12
включительно. В качестве проверки были сгенерированы также альтернированные 2-танглы без учета
поворотов, отражений и симметрий~--- для этого случая имеется аналитическое
решение~\cite{SundbergThistlethwaite1998}. Результаты этих вычислений представлены в
Таблице~\ref{table:old-results-table}, они полностью согласуются с производящей
функцией~\cite{SundbergThistlethwaite1998}.
\begin{table}[ht]\footnotesize
\caption{\small Количество альтернированных 2-танглов без учета поворотов и
отражений.\label{table:old-results-table}} \centering
\begin{tabular}{|c||r|r|r|r|r|r|r|r|r|r|r|r|}
\hline
$n$ & 1 & 2 & 3 &  4 &  5 &  6 &   7 &    8 &    9 &    10 &     11 &     12 \\
\hline\hline
\# & 1 & 2 & 4 & 10 & 29 & 98 & 372 & 1538 & 6755 & 30996 & 146982 & 715120 \\
\hline
\end{tabular}
\end{table}

\begin{table}[ht]\footnotesize
\caption{\small Количество альтернированных $k$-танглов с $n$
перекрестками.\label{table:alternating-tangles-table}} \centering
\begin{tabular*}{90mm}{|c||@{\extracolsep{\fill}}r|r|r|r|r|r|r|r|}
\hline
$k$\textbackslash $n$
    &      1 &      2 &      3 &      4 &       5 &        6 &           7 &           8 \\
\hline\hline
2   & \ul{1} & \ul{1} & \ul{2} & \ul{5} & \ul{13} &  \ul{36} &    \ul{111} &    \ul{373} \\
3   &      . & \ul{1} & \ul{2} & \ul{7} & \ul{20} &  \ul{77} &    \ul{276} & \ul{1\,135} \\
4   &      . &      . & \ul{2} & \ul{8} & \ul{37} & \ul{157} &    \ul{687} & \ul{3\,052} \\
5   &      . &      . &      . & \ul{5} & \ul{31} & \ul{209} & \ul{1\,128} & \ul{5\,986} \\
6   &      . &      . &      . &      . & \ul{16} & \ul{161} & \ul{1\,294} & \ul{8\,528} \\
7   &      . &      . &      . &      . &       . & \ul{ 60} &    \ul{840} &      8\,206 \\
8   &      . &      . &      . &      . &       . &        . &         261 &      4\,702 \\
9   &      . &      . &      . &      . &       . &        . &           . &      1\,243 \\
\hline
все &      1 &      2 &      6 &     25 &     117 &      700 &      4\,597 &     33\,225 \\
\hline
\end{tabular*}

\kern1em

\begin{tabular*}{90mm}{|c||@{\extracolsep{\fill}}r|r|r|r|}
\hline
$k$\textbackslash $n$
    &            9 &           10 &            11 &            12 \\
\hline\hline
2   &  \ul{1\,362} &  \ul{5\,378} &  \ul{22\,807} & \ul{102\,617} \\
3   &  \ul{4\,823} & \ul{21\,734} & \ul{101\,307} &      488\,093 \\
4   & \ul{13\,981} & \ul{65\,797} &      317\,506 &   1\,565\,163 \\
5   & \ul{30\,556} &     155\,964 &      795\,918 &   4\,092\,027 \\
6   &      51\,475 &     294\,366 &   1\,637\,855 &   8\,979\,493 \\
7   &      62\,895 &     428\,254 &   2\,702\,902 &  16\,313\,106 \\
8   &      52\,815 &     460\,189 &   3\,475\,551 &  23\,979\,733 \\
9   &      26\,753 &     341\,878 &   3\,327\,424 &  27\,625\,056 \\
10  &       6\,257 &     155\,593 &   2\,221\,544 &  23\,869\,621 \\
11  &            . &      32\,721 &      916\,595 &  14\,473\,275 \\
12  &            . &            . &      175\,760 &   5\,464\,661 \\
13  &            . &            . &             . &      963\,900 \\
\hline
все &     250\,917 &  1\,961\,874 &  15\,695\,169 & 127\,916\,745 \\
\hline
\end{tabular*}
\end{table}

Таблица~\ref{table:alternating-tangles-table} содержит основной результат~--- распределение
связных простых альтернированных $k$-танглов с $n\le12$ по числу перекрестков и числу ног.
Изображения всех связных простых альтернированных $k$-танглов с числом перекрестков до~4
приведены на \figureref{figure:tangles14}. % и \figureref{figure:tangles5}.
\begin{figure}[H]
\centering
\includegraphics[scale=0.8]{c/alternating-tangles-1-4.eps}
\caption{\footnotesize Альтернированные танглы до 4-х перекрестков\label{figure:tangles14}}
\end{figure}

Отметим, что число альтернированных $k$-танглов растет с увеличением числа перекрестков
несравнимо быстрее, нежели число альтернированных зацеплений. Например, различных зацеплений с 12
перекрестками всего 3308, и даже для $n=19$ зацеплений получается меньше, чем $k$-танглов при
$n=12$.


\begin{thebibliography}{99}

\let\em=\it

\small

\bibitem{Prasolov1997}
{\em Прасолов~В.\,В., Сосинский~А.\,Б.\,}
Узлы, зацепления, косы и трехмерные многообразия. М.: МЦНМО, 1997, 352\,с.

\bibitem{Duzhin1999}
{\em Дужин~С.\,В., Чмутов~С.\,В.}
Узлы и их инварианты. Математическое просвещение, 1999, сер.~3, {\bf 3}, 59--93.

\bibitem{Goussarov2000}
{\em Goussarov~M., Polyak~M., and Viro~O.\,}
Finite type invariants of classical and virtual knots. Topology, 2000, {\bf 39}, 1045--1068.

\bibitem{Kauffman1999}
{\em Kauffman~L.\,}
Virtual knot theory. European Journal~of Combinatorics, 1999, {\bf 20}, 663--690.

\bibitem{Kuperberg2003}
{\em Kuperberg~G.\,}
What is a virtual link? Algebraic \& Geometric Topology, 2003, {\bf 3}, 587--591.

\bibitem{Zvonkin2010}
{\em Звонкин~А.\,К., Ландо~С.\,К.\,}
Графы на поверхностях и их приложения. М.: МЦНМО, 2010, 480\,с.

\bibitem{We_JKTR2007}
{\em Grishanov~S., Meshkov~V., and Omelchenko~A.\,}
Kauffman-type polynomial invariants for doubly periodic
structures. Journal of Knot Theory and Its Ramifications, 2007, vol.\,16, {\bf6}, 779--788.

\bibitem{We_TRJ2009}
{\em Grishanov~S., Meshkov~V., and Omelchenko~A.\,}
A topological study of textile structures. Parts~I,II. Textile Research Journal, 2009,
vol.\,79, {\bf8}, 702--713; 2009, vol.\,79, {\bf9}, 822--836.

\bibitem{We_arXiv2007}
{\em Bogdanov~A., Meshkov~V., Omelchenko~A., and Petrov~M.\,}
Classification of $k$-tangle projections using cascade representation. E-print: \texttt{arXiv:0712.3859v2} [math.GT].

\bibitem{We_Bouquet2010}
{\em Мешков~В.\,Р., Мишунин~А.\,С., Омельченко~А.\,В.\,}
Быстрая генерация неизоморфных одновершинных вложенных графов. Настоящий сборник.

\bibitem{Conway1969}
{\em Conway~J.\,}
An enumeration of knots and links, and some of their algebraic properties.
Computational Problems in Abstract Algebra (John Leech, ed.), Pergamon Press, 1969, 329--358.

\bibitem{KauffmanLambropoulou2004}
{\em Kauffman~L., Lambropoulou~S.\,}
On the classification of rational tangles.
Advances in Applied Mathematics, 2004, {\bf2}, 199--237. e-print:~\texttt{arXiv:math/0311499v2}.

\bibitem{JustinZuber2003}
{\em Zinn-Justin~P., Zuber~J.\,}
Matrix integrals and the generation and counting of virtual tangles and links.
Journal of Knot Theory and Its Ramification, 2004, vol.\,13, {\bf2}, 325--356. e-print:~\texttt{arXiv:math-ph/0303049}.

\bibitem{MenascoThistlethwaite1993}
{\em Menasco~W. and Thistlethwaite~M.\,}
The Classification of Alternating Links. Ann.~Math., 1993, {\bf138}, 113--171.

\bibitem{SundbergThistlethwaite1998}
{\em Sundberg~C. and Thistlethwaite~M.\,}
The Rate of Growth of the Number of Prime Alternating Links and Tangles.
Pacific Journal of Mathematics, 1998, vol.\,182, {\bf2}, 329--358.

\bibitem{Rankin2002}
{\em Rankin~S., Smith~O.\,}
Enumerating the Prime Alternating Links.
Journal of Knot Theory and Its Ramifications, 2004, vol.\,13, {\bf1}, 151--173. e-print:~\texttt{arXiv:math/0211451}

\end{thebibliography}


\end{document}
